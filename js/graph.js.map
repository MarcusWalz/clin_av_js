{"version":3,"sources":["graph.ts"],"names":["Edge","Edge.constructor","Edge.fr","Edge.to","Edge.toString","Edge.isEqual","Edge.isParentOf","Edge.isChildOf","Graph","Graph.constructor","Graph.clone","Graph.getName","Graph.setName","Graph.addNode","Graph.hasNode","Graph.makeEdge","Graph.getNodes","Graph.deleteNode","Graph.addEdge","Graph.getEdges","Graph.hasEdge","Graph.calculateCpt","Graph.getParents","Graph.getChildren","Graph.topSort","Graph.deleteEdge"],"mappings":"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oBAACA,GAAGA,CAACA,IAAIA,CAACA,IAAIA,CAACA,EAAEA,EAAEA,CAACA,CAACA;gBAACA,CAACA;gBAC/CA,MAAMA,CAACA,IAAIA,CAACA;YACdA,CAACA,CAACA,CAACA;YACHA,MAAMA,CAACA,GAAGA,CAACA;QACbA,CAACA;QAEDf,oBAAoBA;QACpBA,uBAAOA,GAAPA;YACEgB,IAAIA,MAAMA,GAAGA,EAAEA,CAACA;YAChBA,IAAIA,CAACA,GAASA,IAAIA,CAACA,KAAKA,EAAEA,CAACA;YAE3BA,AACAA,8CAD8CA;gBAC1CA,CAACA,GACDA,IAAIA,WAAWA,CAACA,GAAGA,CACnBA,UAACA,CAACA,IAAOA,MAAMA,CAACA,CAACA,CAACA,OAAOA,EAAEA,CAACA,CAACA,CAACA,CACjCA,CAACA;YAEFA,CAACA,CAACA,QAAQA,EAAEA,CAACA,OAAOA,CAAEA,UAACA,CAACA;gBACtBA,EAAEA,CAACA,CAACA,CAACA,CAACA,UAAUA,CAACA,CAACA,CAACA,CAACA,MAAMA,KAAKA,CAACA,CAACA,CAACA,CAACA;oBAC7BA,CAACA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA;gBACfA,CAACA;YACHA,CAACA,CAACA,CAACA;YAGHA,OAAOA,CAACA,CAACA,IAAIA,EAAEA,GAAGA,CAACA,EAAEA,CAACA;gBACpBA,IAAIA,CAACA,GAAGA,CAACA,CAACA,OAAOA,EAAEA,CAACA,CAACA,CAACA,CAACA;gBACvBA,CAACA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA;gBACZA,MAAMA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA;gBAEfA,CAACA,CAACA,WAAWA,CAACA,CAACA,CAACA,CAACA,OAAOA,CAACA,UAACA,KAAKA;oBAC7BA,CAACA,CAACA,UAAUA,CAACA,CAACA,EAAEA,KAAKA,CAACA,CAACA;oBACvBA,EAAEA,CAACA,CAACA,CAACA,CAACA,UAAUA,CAACA,KAAKA,CAACA,CAACA,MAAMA,KAAKA,CAACA,CAACA,CAACA,CAACA;wBACrCA,CAACA,CAACA,GAAGA,CAACA,KAAKA,CAACA,CAACA;oBACfA,CAACA;gBACHA,CAACA,CAACA,CAACA;YACLA,CAACA;YAEDA,EAAEA,CAACA,CAACA,CAACA,CAACA,QAAQA,EAAEA,CAACA,MAAMA,KAAKA,CAACA,CAACA,CAACA,CAACA;gBAC5BA,MAAMA,IAAIA,KAAKA,CAACA,kCAAkCA,CAACA,CAACA;YACxDA,CAACA;YACDA,MAAMA,CAACA,MAAMA,CAACA;QAChBA,CAACA;QAEDhB,0BAAUA,GAAVA,UAAWA,EAAwBA,EAAEA,EAAwBA;YAC3DiB,IAAIA,CAACA,KAAKA,CAACA,MAAMA,CAACA,IAAIA,CAACA,QAAQA,CAACA,EAAEA,EAAEA,EAAEA,CAACA,CAACA,CAACA;QAC3CA,CAACA;QACHjB,YAACA;IAADA,CA9JA,AA8JCA,IAAA;IA9JY,aAAK,QA8JjB,CAAA","file":"graph.js","sourcesContent":["/// <reference path=\"app.d.ts\" /> \n/// <reference path=\"graph_node.ts\" /> \n/// <reference path=\"cpt.ts\" /> \n\nimport graph_node = require('graph_node');\nimport cpt        = require('./cpt');\n\n// eval(require('fs').readFileSync('../aux_scripts/collections.js', 'utf8'));\n\n\nexport class Edge {\n  private _fr:graph_node.GraphNode;\n  private _to:graph_node.GraphNode;\n\n  constructor(fr:graph_node.GraphNode, to:graph_node.GraphNode) {\n    if (fr === null || to === null) {\n      throw new Error('Can not construct edge to null node');\n    }\n    if (fr === to) {\n      throw new Error('Edge cannot connect a node onto itself');\n    }\n\n    this._to = to;\n    this._fr = fr;\n  }\n\n  fr(): graph_node.GraphNode {\n    return this._fr;\n  }\n\n  to() : graph_node.GraphNode {\n    return this._to;\n  }\n\n  toString() : string {\n    return this._fr.getName() + '->' + this._to.getName();\n  }\n\n  isEqual(a:Edge):boolean {\n    return a.fr() === this._fr && a.to() === this._to;\n  }\n\n  isParentOf(child:graph_node.GraphNode) : boolean {\n    return child === this._to;\n  }\n\n  isChildOf(parent:graph_node.GraphNode) : boolean {\n    return parent === this._fr;\n  }\n\n}\n\nexport class Graph {\n  private name:string;\n  private nodes:collections.Set<graph_node.GraphNode>;\n  private edges:collections.Set<Edge>;\n\n  constructor(name: string, nodes:graph_node.GraphNode[] = []) {\n    this.name  = name;\n    this.edges = new collections.Set<Edge>();\n    this.nodes = new collections.Set<graph_node.GraphNode>(\n        (gn) => { return gn.getName(); } );\n\n    nodes.forEach((n) => { this.addNode(n); });\n  }\n\n  // create a shallow copy of a graph for topsort\n  private clone() : Graph {\n    var g:Graph = new Graph(this.name);\n\n    this.nodes.forEach((n) => { g.addNode(n); return true; });\n    this.edges.forEach((e) => { \n      g.addEdge(e.fr(), e.to()); return true; });\n\n    return g;\n  }\n\n  getName() : string {\n    return this.name;\n  }\n\n  setName(name: string) {\n\n    this.name = name;\n\n  }\n\n  addNode(node : graph_node.GraphNode) {\n    if (!this.nodes.add(node)) {\n      throw new Error('Node Already Exists in Graph');\n    }\n  }\n\n  hasNode(node : graph_node.GraphNode) {\n    return this.nodes.contains(node);\n  }\n/*\n  getNode(node_name : string) : graph_node.GraphNode {\n    var nodes = this.nodes.toArray();\n\n    for (var i:number = 0; i < nodes.length; i++) {\n      if (nodes[i].getName() === node_name) {\n        return nodes[i];\n      }\n    }\n    return null;\n  }\n*/\n\n  // fails if a node d.n.e in graph\n  private makeEdge(fr: graph_node.GraphNode, to:graph_node.GraphNode) : Edge {\n    if (this.nodes.contains(fr) && this.nodes.contains(to)) {\n      return new Edge(fr, to);\n    } else {\n      throw new Error('Edge can not connect to node not in graph');\n    }\n\n  }\n\n  getNodes() : graph_node.GraphNode[] {\n    return this.nodes.toArray();\n  }\n\n  deleteNode(node: graph_node.GraphNode) { \n    if (this.nodes.remove(node)) {\n      this.edges.forEach( (edge:Edge) => {\n        if (edge.to() === node || edge.fr() === node) {\n          this.edges.remove(edge);\n        }\n        return true;\n      });\n    }\n  }\n\n  addEdge(fr: graph_node.GraphNode, to: graph_node.GraphNode) {\n    this.edges.add(this.makeEdge(fr, to));\n  }\n\n  // returns edges as 2d array of node/column names\n  getEdges() : Edge[] {\n    return this.edges.toArray();\n  }\n\n  hasEdge(fr: graph_node.GraphNode, to: graph_node.GraphNode) : boolean {\n    return this.edges.contains(this.makeEdge(fr, to));\n  }\n\n  calculateCpt(node: graph_node.GraphNode) : cpt.CPT {\n    return new cpt.CPT(node, this.getParents(node));\n  }\n\n\n  getParents(n : graph_node.GraphNode) : graph_node.GraphNode[] {\n    var out = [];\n    this.edges.forEach((edge) => {\n      if (edge.isParentOf(n)) { out.push(edge.to()); }\n      return true;\n    });\n    return out;\n  }\n\n  getChildren(n : graph_node.GraphNode) : graph_node.GraphNode[] {\n    var out = [];\n    this.edges.forEach((edge) => {\n      if (edge.isChildOf(n)) { out.push(edge.to()); }\n      return true;\n    });\n    return out;\n  }\n\n  // topological sort \n  topSort() : graph_node.GraphNode[] {\n    var sorted = [];\n    var g:Graph = this.clone();\n\n    // the set of all nodes containing no children\n    var s:collections.Set<graph_node.GraphNode> \n      = new collections.Set<graph_node.GraphNode>(\n        (n) => { return n.getName(); }\n    ); \n\n    g.getNodes().forEach( (n) => { \n      if (g.getParents(n).length === 0) {\n            s.add(n); \n      }\n    });\n\n\n    while (s.size() > 0) {\n      var n = s.toArray()[0];\n      s.remove(n);\n      sorted.push(n);\n      \n      g.getChildren(n).forEach((child) => {\n        g.deleteEdge(n, child);\n        if (g.getParents(child).length === 0) {\n          s.add(child);\n        }\n      });\n    }\n\n    if (g.getEdges().length !== 0) {\n        throw new Error('Can Not TopSort, Graph in Cyclic');\n    }\n    return sorted;\n  }\n\n  deleteEdge(fr: graph_node.GraphNode, to: graph_node.GraphNode) {\n    this.edges.remove(this.makeEdge(fr, to));\n  }\n}\n"],"sourceRoot":"/source/"}